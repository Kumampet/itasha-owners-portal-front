「痛車オーナーズポータル」アーキテクチャ提案書 (コスト最適化版)1. エグゼクティブサマリー本提案は、痛車イベント特有のペイン（併せ管理、期限管理）を解消し、既存SNS（X）の仕様変更リスク（DM制限）からコミュニティを守るためのプラットフォーム構築案です。（決済機能はスコープ外とします。）開発コンセプト: "Cost-Effective App-like Experience & Non-Competitive"最重要方針: ユーザー間のフォロー機能やイベントのフォロー数公開など、競争や自己顕示欲を満たすSNS的な要素は一切排除し、痛車活動をサポートする情報プラットフォームに特化します。Low Cost First: コスト効率を最優先し、AWS無料利用枠（Free Tier）を最大限活用。App Runner/Auroraを避け、Amplify Hosting/RDS t4g.microを採用。Marketing Integrated (LP機能): トップページをLP化し、未登録ユーザーにメリットを訴求。Mobile First & Responsive: ユーザーの9割がスマホ利用であることを前提にUI/UXを設計。PWA First: ネイティブアプリ同等のUX（プッシュ通知、カレンダー連携）を低コストで提供。2. 技術スタック選定 (AWS Native / コスト最適化)A. フロントエンド (Web & PWA)Framework: Next.js (App Router)Security: Middleware Basic Auth (for /admin)PWA Support: next-pwaUI Library: Shadcn UI + Tailwind CSSLP Animation: Framer Motion (LPとしての魅力を高めるために追加採用)UI/UX Strategy (Mobile First):Navigation: スマホ時は**「ボトムタブバー」、PC時は「固定サイドバーナビゲーション」**を推奨。B. バックエンド & コンピュート (コスト削減ポイント)App Server / Hosting: AWS Amplify Hosting (Next.js SSR/SSGサポート)理由: App Runner（常時起動）よりコスト効率が良く、無料枠が利用可能なため。非同期処理: AWS Lambda (Node.js/TypeScript)理由: EventBridge Schedulerと連携し、低コストでリマインダーやボットを実行。Language: TypeScript (Node.js)C. データベース & CMSデータソース (コスト削減ポイント)RDBMS: Amazon RDS for PostgreSQL (t4g.micro インスタンス)理由: Aurora Serverless v2は高額なため、少量のトラフィックに適した無料枠の多いRDS t4g/t3インスタンスを選択。検索機能（FTS）の組み込みにも適している。【リスクヘッジ】 CloudWatchによるCPUクレジット残高の最優先監視を必須とし、バースト性能低下時に備える。D. 通知 & コミュニケーション基盤Web Push: Firebase Cloud Messaging (FCM)Email: Amazon SES (特に団体の一斉連絡で必須)Chat Integration: Discord Webhook (情報提供や更新通知用)Scheduler: Amazon EventBridge Scheduler3. アーキテクチャ構成図コード スニペットgraph TD
    subgraph "Client Side (PWA / Mobile First)"
        User[痛車オーナー] -->|Visit| AmplifyHosting[AWS Amplify Hosting (CDN/App)]
        AmplifyHosting -->|Routing| Middleware[Next.js Middleware]
        
        Middleware -- Unauthenticated --> LP[Landing Page (SEO/Conversion)]
        Middleware -- Authenticated --> App[App Dashboard (PWA View)]
        
        User -->|Web Push| FCM[Firebase Cloud Messaging]
    end

    subgraph "Server Side (Low Cost Compute)"
        LambdaBot[AWS Lambda (更新検知ボット/リマインダー)] -->|Scheduled Rule| EventBridge[Amazon EventBridge Scheduler]
        
        AmplifyHosting -->|API Calls (Next.js API Routes)| RDS[RDS PostgreSQL (t4g.micro)]
        LambdaBot --> RDS
        
        LambdaBot --> SES[Amazon SES]
        LambdaBot --> Discord[Discord Webhook (情報提供通知)]
    end
    
    subgraph "Data Layer"
        RDS
    end
4. 具体的なソリューション (機能実装)① LP兼トップページ戦略 (Smart Routing)動的ルーティング (Middleware): 未ログイン時はLP、ログイン済時はダッシュボードを表示。SEO対策: LP部分をSSR/SSGで構築し、検索エンジンにインデックスさせる。② PWA & リマインダー (Mobile UX)ネイティブアプリ風レイアウト: スマホはボトムタブ、PCはサイドバーナビゲーションを採用し、アプリらしい一貫性を保ちつつ情報アクセスを向上させる。プッシュ通知: EventBridge SchedulerとLambda連携で、エントリー開始時刻にFCM経由でプッシュ通知を送信。【リスク軽減】 PWA通知の確実性が低いことを前提とし、重要度の高い通知はメールを併用する（⑥を参照）。カレンダー連携 (iCal形式): Next.jsのAPIルートを利用し、イベントデータ（開催日、エントリー日など）を元に**iCal形式（.icsファイル）**を動的に生成・提供。タイムゾーンの厳密なテストを必須とする。③ 自社製CMS (Admin Dashboard)Defense in Depth: Basic認証 + Cognito認証 + RBACの3層防御。Mobile Admin: 外出先からスマホで承認作業が可能。④ 段階的情報の追跡システム (X非依存のローテク戦略)方針: 高額なX API利用を避け、管理者の手動入力とユーザーコミュニティの協力を前提とします。Webサイトの更新検知:LambdaはCMSに登録された公式サイトURL（Xの投稿URLも含む）を巡回し、ページの更新またはURLのアクセス不能を検知した場合にDiscordへ通知。ユーザーによる情報提供:アプリ内に「イベント情報を提供」フォームを設置。ユーザーがイベント情報を入力すると、Discordの専用チャネルへWebhookで通知。【運用負荷軽減】 Phase 2で、Webhookで得た情報をCMSのフォームに半自動で反映させる機能を検討する。⑤ (将来機能) イベントオーガナイザー権限の開放権限昇格フロー: 管理者のCMS承認により、ユーザーの is_organizer フラグを true に設定し、イベント登録フォームを開放。【運用負荷軽減】 将来的に、Trusted Organizersにはイベント情報の入力・編集権限を付与し、管理者は最終承認のみを行うモデル（CMS v2）を視野に入れる。⑥ 団体参加（併せ）管理機能目的: イベントの「団体参加（併せ）」におけるメンバー募集、コミュニケーション、および情報共有の場を提供する。X DM代替: リーダーが「一斉連絡」として投稿すると、団体の全メンバーに対してメール通知（SES）とアプリ内通知が送信される仕組みを採用。【必須要件】 団体メッセージ (Group_Messages) で is_announcement = true の場合、Amazon SESによるメール通知を必須とする。メールのオプトアウト（配信停止）機能とバウンス率監視はSESのレピュテーション保護のため必ず実装する。⑦ 検索機能の実現ソリューション: Amazon RDS for PostgreSQLの組み込みFull-Text Search (FTS) 機能とタグ機能を採用。実装: Events テーブルのイベント名、テーマ、概要、タグを全て検索対象に含め、DBレベルで高速な全文検索・キーワード検索を行うことで、OpenSearchなどの追加費用を回避。⑧ マイページと公開プロフィールの提供SNS要素の排除: ユーザー間のフォロー/フォロワー機能や、いいね/ランキングといった競争要素は一切排除。マイページ（本人限定）： リマインダーリスト、参加ステータス管理、フォローイベントリスト（非公開）。公開プロフィール（活動共有）： 過去・未来の参加決定済イベント、参加中の団体情報を外部ユーザーに公開。5. データモデル設計 (RDS for PostgreSQL)【RDSへの統合理由】 団体の多対多リレーションシップ管理、イベント期限のソート、および将来の全文検索機能（FTS）を低コストで一元的に実現するため、すべてのアプリケーションデータをPostgreSQLに格納します。Events Table (Master):original_url (追加): イベント情報の追跡・更新検知のためのURL。event_date, entry_start_at, payment_due_at, approval_status, organizer_user_idUser_Events Table:group_id (追加, Optional): ユーザーがどの併せ（団体）に参加しているかを示すID。user_id, event_id, status, push_subscriptionUsers Table:id (PK, Cognito Sub), email, is_banned, role, is_organizer, is_profile_public, custom_profile_urlGroups Table (団体情報): id, event_id, name, theme, leader_user_id, max_membersGroup_Members Table (廃止): User_Events.group_id に統合されるため、このテーブルは廃止。Group_Messages Table (団体メッセージ): id, group_id, user_id, content, is_announcement, created_atTags Table (タグマスター): id, name, usage_countEvent_Tags Table (イベント-タグ紐付け): event_id, tag_idEvent_Follows Table (イベントフォロー): user_id, event_id, followed_at6. 開発ロードマップ案 (PWA/CMS優先)Phase 1 (MVP & PWA Foundation):LP実装、モバイルファーストUI/UX実装。認証基盤 (Cognito, X/Google連携)。CMS (v1): 管理者ログイン、イベント承認機能、情報提供フォーム受付。マイページの基本機能（リマインダーリスト、iCal連携、フォローイベントリスト）。Phase 2 (Community & Safety):団体機能: メンバー募集、連絡掲示板、メンバー管理。検索機能: PostgreSQL FTSとタグ検索の実装。公開プロフィール機能実装。更新検知ボット (Lambda/EventBridge) の実装。【運用負荷軽減】 ユーザー提供情報をCMSフォームに半自動反映する機能を検討。Phase 3 (Expansion):オーガナイザー向け機能開放。Phase 4 (Native & Stability):ネイティブアプリ化の検討・移行: **「通知の未着に関する問い合わせが一定数を超えた場合」**をトリガーとして、Flutterなどを用いたiOS/Androidネイティブアプリへの移行を検討。ネイティブ化の目的: プッシュ通知の確実性の向上と、アプリストアを通じた集客の強化。7. 持続可能な収益化モデル (Monetization)広告掲載ポリシー (No Stress): オーバーレイ禁止。インフィード広告（イベント一覧に馴染ませる）を推奨。CLS対策: Google AdSenseの広告枠を事前確保し、表示速度への悪影響を防ぐ。8. コスト最適化戦略と試算 (最重要)このアーキテクチャの月額費用は、AWS無料利用枠（Free Tier）の終了後を想定し、月額約16ドル〜26ドルに抑えることを目標とします。サービス想定されるコスト無料利用枠終了後の試算（月額）備考RDS PostgreSQLt4g.microインスタンス + 20GB SSD$15〜$2024時間常時稼働のベース費用。安定性のための必要経費。CloudWatchによるCPUクレジット監視は必須。AWS Amplify Hostingホスティング、データ転送量 (低トラフィック)$0〜$5データ転送量超過分のみ。基本無料枠で運用可能。AWS Lambda実行回数 (リマインダー, ボット, API)$0〜$1毎月100万リクエストまで無料。極めて低コスト。Amazon Cognito認証（ログイン）$0毎月5万MAU（アクティブユーザー）まで無料。Amazon SESメール送信 (リマインダー)$0最初の62,000通/月は無料。FCMプッシュ通知$0基本無料。合計$15〜$26程度年間で約3万円以下。広告収益でのカバーを目指す。